<header id="page-header" class="page-header">
	<div class="container">
	  <div class="row">
		<div class="col-12 offset-0 col-md-10 offset-md-1">
		  <figure class="page-logo"><a href="/"><img src="/images/logo.svg" alt="Dgraph Logo"></a></figure>
				  {{if .Site.Params.github}}
			<span class="topnav-stargazers-wrapper">
			  <a href="https://github.com/{{.Site.Params.github}}" data-show-count="true" aria-label="Star Dgraph on GitHub" class="github-button">Star</a>
			</span>
		  {{end}}
  
		  	<span 
				onclick="toggleVisibility()"  
			  	class="search-button pull-right button button-dgraph-site button--outline"
			>
			<i class="fa fa-search" aria-hidden="true"></i>
		  </span>
  
		  <a
			  href="{{.Site.Params.website}}"
			  title="Dgraph Website"
			  class="button button-dgraph-site button--outline pull-right"
		  >
			Dgraph.io
		  </a>
		</div>
	  </div>

	  <div id="searchbox"></div>

	</div>
  
	<script>
		let showSearch = true;
		let widgetContainer = {};

		const toggleVisibility = () => {
			widgetContainer.style.display = showSearch? "none" : "";
			showSearch = !showSearch;
		}

		const parseSummary = (summary) => summary.trim().replace("<p>", "").replace("</p>", "");

const renderTags = tags => `
	<div class="tag-wrapper">
	${
		tags.map(tag => `
			<span class="tag">
				${tag}
			</span>
		`)
		.join('')
	}
	</div>
`;

// Helper for the render function
const renderIndexListItem = ({ indexId, hits }) => `
<li> 
	<div class="results-header">
		<div class="number-of-results">
			${hits.length} results found.
		</div>
		<div class="close-button">
			X
		</div>
	</div>

  	<ol>
		${hits
			.slice(0, 5)
			.map(
				hit =>
				`<li 
						class="search-listing"
						onclick="window.location.href='${hit.permalink}'"
					>
					<div class="title">${instantsearch.highlight({ attribute: 'title', hit })}</div>
					<div class="summary">${parseSummary(hit.summary)} </div>
					<div>${renderTags(hit.tags || [])}</div>
				</li>`
			)
			.join('')}
  	</ol>
</li>
`;

// Create the render function
const renderAutocomplete = (renderOptions, isFirstRender) => {
	const { indices, currentRefinement, refine, widgetParams } = renderOptions;

	if (isFirstRender) {
		const input = document.createElement('input');
		const ul = document.createElement('ul');
		
		ul.className = "search-results";
		input.className = "search-input";
		input.placeholder = "Search...";

		input.addEventListener('input', event => {
			refine(event.currentTarget.value);
		});

		widgetParams.container.appendChild(input);
		widgetParams.container.appendChild(ul);
		widgetContainer = widgetParams.container;

		toggleVisibility();
	}

	widgetParams.container.querySelector('input').value = currentRefinement;

	const showSearchResults = widgetParams.container.querySelector('input') === document.activeElement;
	
	if (currentRefinement && showSearchResults) {
		widgetParams.container.querySelector('ul').style.display = "";
		widgetParams.container.querySelector('ul').innerHTML = indices
		.map(renderIndexListItem)
		.join('');
	} else {
		widgetParams.container.querySelector('ul').innerHTML = "";
		widgetParams.container.querySelector('ul').style.display = "none"
	}
};

const createSearch = () => {
	// Create the custom widget
	const customAutocomplete = instantsearch.connectors.connectAutocomplete(
		renderAutocomplete
	);



	const client = algoliasearch('ACO13Q5JXW', '140be40b311ca64b71564f19bb2f0995');
	// const index = client.initIndex('/');
	const search = instantsearch({
		indexName: 'dgraph_blog',
		searchClient: client,
	});
	search.addWidgets([
		customAutocomplete({
			container: document.querySelector('#searchbox'),
		})
	]);

	search.start();
};

createSearch();
	</script>
  </header>
  